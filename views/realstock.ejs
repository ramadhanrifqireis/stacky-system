<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real Stock Digiflazz</title>
    <link rel="stylesheet" href="/store.css">
    <style>
        /* Gaya tambahan untuk Modal */
        .modal { display: none; position: fixed; z-index: 99; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); }
        .modal-content { background: white; margin: 15% auto; padding: 20px; border-radius: 10px; width: 90%; max-width: 400px; }
        .badge { padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: bold; }
        .bg-green { background: #d1fae5; color: #065f46; }
        .bg-red { background: #fee2e2; color: #991b1b; }
        .header-saldo { background: linear-gradient(135deg, #6366f1, #a855f7); color: white; padding: 20px; border-radius: 12px; margin-bottom: 20px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header-saldo">
            <h3>üí∞ Saldo Digiflazz</h3>
            <h1>Rp <%= typeof saldo !== 'undefined' ? saldo.toLocaleString('id-ID') : 0 %></h1>
            <p>Live Connection</p>
        </div>

        <div class="card">
            <h3>üíé Live Stock: Mobile Legends</h3>
            <div style="overflow-x: auto;">
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="text-align: left; border-bottom: 2px solid #eee;">
                            <th style="padding: 10px;">SKU</th>
                            <th style="padding: 10px;">Produk</th>
                            <th style="padding: 10px;">Modal</th>
                            <th style="padding: 10px;">Status</th>
                            <th style="padding: 10px;">Aksi</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% products.forEach(p => { %>
                        <tr style="border-bottom: 1px solid #f3f4f6;">
                            <td style="padding: 10px; font-family: monospace; font-size: 0.9em;"><%= p.buyer_sku_code %></td>
                            <td style="padding: 10px;"><%= p.product_name %></td>
                            <td style="padding: 10px; font-weight: bold;">Rp <%= p.price.toLocaleString('id-ID') %></td>
                            <td style="padding: 10px;">
                                <% if(p.seller_product_status && p.stock_status === 'available') { %>
                                    <span class="badge bg-green">READY</span>
                                <% } else { %>
                                    <span class="badge bg-red">GANGGUAN</span>
                                <% } %>
                            </td>
                            <td style="padding: 10px;">
                                <% if(p.seller_product_status && p.stock_status === 'available') { %>
                                    <button class="btn-small" onclick="bukaModal('<%= p.buyer_sku_code %>', '<%= p.product_name %>', <%= p.price %>)">
                                        Pilih
                                    </button>
                                <% } else { %>
                                    <button disabled style="opacity: 0.5;">X</button>
                                <% } %>
                            </td>
                        </tr>
                        <% }) %>
                    </tbody>
                </table>
            </div>
        </div>
        <br>
        <a href="/" style="display: block; text-align: center; padding: 10px; background: #eee; border-radius: 8px; text-decoration: none; color: #333;">üè† Kembali ke Dashboard</a>
    </div>

    <div id="orderModal" class="modal">
        <div class="modal-content">
            <h3>üöÄ Proses Order Otomatis</h3>
            <p id="namaProdukDisplay" style="font-weight: bold; color: #6366f1;"></p>
            
            <form action="/process-order-digi" method="POST">
                <input type="hidden" name="sku" id="skuInput">
                <input type="hidden" name="item_name" id="itemNameInput">
                <input type="hidden" name="modal_price" id="modalPriceInput">
                
                <div class="form-group">
                    <label>ID Tujuan (Zone ID Gabung)</label>
                    <input type="text" name="target_data" placeholder="Contoh: 12345678 (2022)" required style="width: 100%; padding: 10px; margin: 5px 0;">
                    <small style="color: red;">*Pastikan ID benar! Saldo langsung terpotong.</small>
                </div>
                
                <div class="form-group">
                    <label>Nama Pembeli</label>
                    <input type="text" name="buyer_name" placeholder="Nama Customer" required style="width: 100%; padding: 10px; margin: 5px 0;">
                </div>

                <div style="margin-top: 15px; text-align: right;">
                    <button type="button" onclick="tutupModal()" style="background: #ccc; padding: 8px 15px; border: none; border-radius: 5px;">Batal</button>
                    <button type="submit" style="background: #6366f1; color: white; padding: 8px 15px; border: none; border-radius: 5px;">GAS ORDER! üî•</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        function bukaModal(sku, name, price) {
            document.getElementById('skuInput').value = sku;
            document.getElementById('itemNameInput').value = name;
            document.getElementById('modalPriceInput').value = price;
            document.getElementById('namaProdukDisplay').innerText = name + " (Rp " + price.toLocaleString() + ")";
            document.getElementById('orderModal').style.display = "block";
        }
        function tutupModal() {
            document.getElementById('orderModal').style.display = "none";
        }
    </script>
</body>
</html>