<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gudang Pusat Digiflazz</title>
    <link rel="stylesheet" href="/store.css">
    <style>
        /* Gaya Khusus Halaman Restock (Grid System) */
        body { background: #f3f4f6; font-family: sans-serif; padding-bottom: 80px; }
        
        .top-header {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white; padding: 25px 20px; border-radius: 0 0 25px 25px;
            box-shadow: 0 5px 20px rgba(79, 70, 229, 0.3); text-align: center; margin-bottom: 25px;
        }

        .saldo-box {
            background: rgba(255,255,255,0.2); backdrop-filter: blur(5px);
            padding: 10px 20px; border-radius: 12px; display: inline-block; margin-top: 10px;
            border: 1px solid rgba(255,255,255,0.3);
        }

        .grid-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr); /* 2 Kolom di HP */
            gap: 12px; padding: 0 15px; max-width: 800px; margin: 0 auto;
        }

        /* Tampilan Kartu Produk */
        .item-card {
            background: white; border-radius: 15px; padding: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            display: flex; flex-direction: column; justify-content: space-between;
            transition: transform 0.2s; border: 2px solid transparent;
        }
        
        .item-card:active { transform: scale(0.98); }
        .item-card.ready { border-color: #d1fae5; }
        .item-card.gangguan { border-color: #fee2e2; opacity: 0.7; }

        .sku-badge { font-size: 10px; background: #eee; padding: 3px 6px; border-radius: 4px; color: #666; width: fit-content; margin-bottom: 5px;}
        
        .item-name { font-size: 13px; font-weight: bold; color: #333; margin-bottom: 10px; line-height: 1.3; }
        
        .price-tag { font-size: 16px; font-weight: 800; color: #4f46e5; display: block; margin-bottom: 8px;}
        
        .btn-action {
            width: 100%; padding: 8px; border-radius: 8px; border: none; font-weight: bold; font-size: 12px; cursor: pointer;
        }
        .btn-blue { background: #4f46e5; color: white; }
        .btn-gray { background: #e5e7eb; color: #9ca3af; }

        /* Modal Popup */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 999; backdrop-filter: blur(3px); }
        .modal-content { background: white; width: 85%; max-width: 350px; margin: 20% auto; padding: 20px; border-radius: 15px; animation: slideUp 0.3s; }
        @keyframes slideUp { from {transform: translateY(20px); opacity: 0;} to {transform: translateY(0); opacity: 1;} }
        
        input { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; margin: 5px 0 15px 0; box-sizing: border-box; }
    </style>
</head>
<body>

    <div class="top-header">
        <h2 style="margin:0">ðŸ“¦ Stok Pusat (Digi)</h2>
        <div class="saldo-box">
            <small>Saldo Digiflazz</small><br>
            <strong style="font-size: 18px;">Rp <%= typeof saldo !== 'undefined' ? saldo.toLocaleString('id-ID') : 0 %></strong>
        </div>
    </div>

    <div class="grid-container">
        <% if (products && products.length > 0) { %>
            <% products.forEach(p => { %>
                <div class="item-card <%= (p.seller_product_status && p.stock_status === 'available') ? 'ready' : 'gangguan' %>">
                    <div>
                        <div class="sku-badge"><%= p.buyer_sku_code %></div>
                        <div class="item-name"><%= p.product_name %></div>
                    </div>
                    <div>
                        <span class="price-tag">Rp <%= p.price.toLocaleString('id-ID') %></span>
                        
                        <% if(p.seller_product_status && p.stock_status === 'available') { %>
                            <button class="btn-action btn-blue" onclick="bukaModal('<%= p.buyer_sku_code %>', '<%= p.product_name %>', <%= p.price %>)">
                                âš¡ TEMBAK STOK
                            </button>
                        <% } else { %>
                            <button class="btn-action btn-gray" disabled>GANGGUAN</button>
                        <% } %>
                    </div>
                </div>
            <% }) %>
        <% } else { %>
            <div style="grid-column: span 2; text-align: center; color: #888; margin-top: 50px;">
                <p>Gagal memuat produk. <br> Cek koneksi / Config Digiflazz.</p>
            </div>
        <% } %>
    </div>

    <div style="text-align: center; margin-top: 30px;">
        <a href="/" style="color: #666; text-decoration: none; font-size: 14px;">â¬… Kembali ke Menu Utama</a>
    </div>

    <div id="modalOrder" class="modal">
        <div class="modal-content">
            <h3 style="margin-top:0">ðŸŽ¯ Isi Stok Ke...</h3>
            <p id="namaProduk" style="font-size: 13px; color: #4f46e5; font-weight: bold;"></p>
            
            <form action="/process-order-digi" method="POST">
                <input type="hidden" name="sku" id="inputSku">
                <input type="hidden" name="item_name" id="inputName">
                <input type="hidden" name="modal_price" id="inputPrice">
                
                <label style="font-size: 12px; font-weight: bold;">Target ID (User ID + Zone)</label>
                <input type="number" name="target_data" placeholder="Contoh: 123456782022" required autofocus>
                
                <label style="font-size: 12px; font-weight: bold;">Catatan (Untuk siapa?)</label>
                <input type="text" name="buyer_name" placeholder="Contoh: Stok Toko / Customer WA">

                <div style="display: flex; gap: 10px;">
                    <button type="button" onclick="document.getElementById('modalOrder').style.display='none'" class="btn-action btn-gray">Batal</button>
                    <button type="submit" class="btn-action btn-blue">ðŸ”¥ GAS KIRIM</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        function bukaModal(sku, nama, harga) {
            document.getElementById('inputSku').value = sku;
            document.getElementById('inputName').value = nama;
            document.getElementById('inputPrice').value = harga;
            document.getElementById('namaProduk').innerText = nama;
            document.getElementById('modalOrder').style.display = 'block';
        }
    </script>

</body>
</html>