<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Main Stock ‚Äî Digiflazz</title>
    <link rel="stylesheet" href="/css/store.css">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <style>
        body { background: #f3f4f6; font-family: sans-serif; padding-bottom: 120px; }
        .rs-wrap { max-width: 800px; margin: 0 auto; padding: 0 15px; }
        .rs-section { background: white; border-radius: 16px; padding: 22px; margin-bottom: 20px; box-shadow: 0 2px 12px rgba(0,0,0,0.04); }
        .rs-section-title { font-size: 12px; font-weight: 700; color: #6b7280; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 16px; }
        .top-header {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white; padding: 22px 20px; border-radius: 0 0 24px 24px;
            box-shadow: 0 6px 20px rgba(79, 70, 229, 0.25); text-align: center; margin-bottom: 28px;
        }
        .saldo-box {
            background: rgba(255,255,255,0.22); backdrop-filter: blur(8px);
            padding: 10px 20px; border-radius: 12px; display: inline-block; margin-top: 8px;
            border: 1px solid rgba(255,255,255,0.3);
        }
        .form-group { margin-bottom: 14px; }
        .form-group label { font-size: 12px; font-weight: 600; color: #374151; display: block; margin-bottom: 6px; }
        .form-control-rs { width: 100%; padding: 12px; border: 1px solid #e5e7eb; border-radius: 10px; font-size: 14px; box-sizing: border-box; }
        .form-control-rs:focus { outline: none; border-color: #4f46e5; }
        .helper-text { font-size: 11px; color: #6b7280; margin-top: 4px; }
        .grid-container { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
        .item-card {
            background: white; border-radius: 14px; padding: 14px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.04);
            display: flex; flex-direction: column; justify-content: space-between;
            transition: transform 0.2s; border: 2px solid transparent;
        }
        .item-card:active { transform: scale(0.98); }
        .item-card.ready { border-color: #d1fae5; }
        .item-card.gangguan { border-color: #fee2e2; opacity: 0.75; }
        .sku-badge { font-size: 10px; background: #f3f4f6; padding: 3px 6px; border-radius: 4px; color: #6b7280; width: fit-content; margin-bottom: 6px; }
        .item-name { font-size: 13px; font-weight: 700; color: #111; margin-bottom: 8px; line-height: 1.3; }
        .price-tag { font-size: 15px; font-weight: 800; color: #4f46e5; display: block; margin-bottom: 8px; }
        .btn-action { width: 100%; padding: 10px; border-radius: 10px; border: none; font-weight: 700; font-size: 12px; cursor: pointer; }
        .btn-blue { background: #4f46e5; color: white; }
        .btn-gray { background: #e5e7eb; color: #6b7280; }
        .hutang-list { max-height: 180px; overflow-y: auto; }
        .hutang-item { display: flex; align-items: center; gap: 12px; padding: 12px 0; border-bottom: 1px solid #f3f4f6; }
        .hutang-item:last-child { border-bottom: none; }
        .hutang-item input[type="checkbox"] { width: 18px; height: 18px; accent-color: #4f46e5; }
        .hutang-item label { flex: 1; font-size: 13px; font-weight: 600; color: #374151; cursor: pointer; margin: 0; }
        .btn-toggle-all { font-size: 12px; font-weight: 600; color: #4f46e5; background: #eef2ff; padding: 8px 14px; border-radius: 8px; border: none; cursor: pointer; margin-top: 8px; }
        /* Kotak info WDP ‚Äî mencolok tapi tidak berlebihan */
        .wdp-info {
            background: linear-gradient(135deg, #eef2ff 0%, #f5f3ff 100%);
            border: 1px solid rgba(79, 70, 229, 0.18);
            border-radius: 14px;
            padding: 18px 20px;
            margin-bottom: 24px;
            box-shadow: 0 2px 10px rgba(79, 70, 229, 0.06);
        }
        .wdp-info-title { font-size: 13px; font-weight: 700; color: #4338ca; margin-bottom: 12px; letter-spacing: 0.2px; }
        .wdp-info-row { display: flex; justify-content: space-between; align-items: center; padding: 6px 0; font-size: 13px; }
        .wdp-info-row .label { color: #4b5563; font-weight: 500; }
        .wdp-info-row .value { color: #1f2937; font-weight: 700; }
        .wdp-info-divider { border-top: 1px solid rgba(79,70,229,0.15); margin-top: 6px; padding-top: 10px; }
        .wdp-target-box {
            background: #fff; border: 1px solid #e5e7eb; border-radius: 14px;
            padding: 14px 18px; margin-bottom: 24px; box-shadow: 0 2px 8px rgba(0,0,0,0.04);
        }
        .wdp-target-form { margin-top: 6px; }
        .wdp-target-inputs { display: flex; gap: 12px; align-items: flex-end; flex-wrap: wrap; margin-bottom: 10px; }
        .wdp-target-col { flex: 1; min-width: 0; }
        .wdp-target-label { font-size: 11px; font-weight: 600; color: #6b7280; display: block; margin-bottom: 4px; }
        .wdp-target-input { width: 100%; max-width: 140px; }
        .wdp-target-btn { padding: 8px 16px; font-size: 12px; margin-top: 2px; }
        .rs-wrap { padding-top: 4px; }
        .rs-section { margin-bottom: 24px; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 999; backdrop-filter: blur(4px); }
        .modal.show { display: flex; align-items: center; justify-content: center; }
        .modal-content { background: white; width: 90%; max-width: 360px; padding: 22px; border-radius: 16px; box-shadow: 0 20px 40px rgba(0,0,0,0.15); }
        .modal-detail-row { font-size: 13px; margin-bottom: 8px; }
        .modal-detail-row strong { color: #6b7280; display: inline-block; min-width: 100px; }
        input.form-control-rs { margin-bottom: 0; }
    </style>
</head>
<body>

    <div class="top-header">
        <h2 style="margin:0">üì¶ Main Stock (Digi)</h2>
        <div class="saldo-box">
            <small>Saldo Digiflazz</small><br>
            <strong style="font-size: 18px;">Rp <%= typeof saldo !== 'undefined' ? saldo.toLocaleString('id-ID') : 0 %></strong>
        </div>
    </div>

    <div class="rs-wrap">
        <div class="wdp-info">
            <div class="wdp-info-title">Info Harga WDP (Weekly Diamond Pass)</div>
            <div class="wdp-info-row">
                <span class="label">Termurah Brazil</span>
                <span class="value"><%= (typeof wdp_cheapest !== 'undefined' && wdp_cheapest && wdp_cheapest.brazil != null) ? 'Rp ' + Number(wdp_cheapest.brazil).toLocaleString('id-ID') : '-' %></span>
            </div>
            <div class="wdp-info-row">
                <span class="label">Termurah Turkey</span>
                <span class="value"><%= (typeof wdp_cheapest !== 'undefined' && wdp_cheapest && wdp_cheapest.turkey != null) ? 'Rp ' + Number(wdp_cheapest.turkey).toLocaleString('id-ID') : '-' %></span>
            </div>
            <div class="wdp-info-row wdp-info-divider">
                <span class="label">Harga saat ini (WDP BR)</span>
                <span class="value"><%= (typeof wdp_current_prices !== 'undefined' && wdp_current_prices && wdp_current_prices.WDP_BR != null) ? 'Rp ' + Number(wdp_current_prices.WDP_BR).toLocaleString('id-ID') : '-' %></span>
            </div>
            <div class="wdp-info-row">
                <span class="label">Harga saat ini (WDP TR)</span>
                <span class="value"><%= (typeof wdp_current_prices !== 'undefined' && wdp_current_prices && wdp_current_prices.WDP_TR != null) ? 'Rp ' + Number(wdp_current_prices.WDP_TR).toLocaleString('id-ID') : '-' %></span>
            </div>
        </div>

        <div class="wdp-target-box">
            <div class="wdp-info-title">üéØ Target Notifikasi (Termux)</div>
            <p class="helper-text" style="margin-bottom: 8px;">Harga ‚â§ target ‚Üí notif ke perangkat.</p>
            <form action="/api/save-wdp-targets" method="POST" id="wdpTargetForm" class="wdp-target-form">
                <div class="wdp-target-inputs">
                    <div class="wdp-target-col">
                        <label class="wdp-target-label">WDP BR (Rp)</label>
                        <input type="number" name="WDP_BR" class="form-control-rs wdp-target-input" placeholder="0 = off" min="0" value="<%= (typeof price_targets !== 'undefined' && price_targets && price_targets.WDP_BR) ? price_targets.WDP_BR : '0' %>">
                    </div>
                    <div class="wdp-target-col">
                        <label class="wdp-target-label">WDP TR (Rp)</label>
                        <input type="number" name="WDP_TR" class="form-control-rs wdp-target-input" placeholder="0 = off" min="0" value="<%= (typeof price_targets !== 'undefined' && price_targets && price_targets.WDP_TR) ? price_targets.WDP_TR : '0' %>">
                    </div>
                </div>
                <button type="submit" class="btn-action btn-blue wdp-target-btn">Simpan Target</button>
            </form>
        </div>
        <% var accountsHutang = (typeof accounts !== 'undefined' && accounts.length) ? accounts.filter(function(a){ return a.pending_wdp; }) : []; %>
        <% if (accountsHutang.length > 0) { %>
        <div class="rs-section">
            <div class="rs-section-title">üè∑Ô∏è Lunasi Hutang</div>
            <p class="helper-text" style="margin-bottom: 10px;">Centang akun yang ingin dilunasi (topup via form di bawah akan melunasi hutang terlebih dulu).</p>
            <div class="hutang-list" id="hutangList">
                <% accountsHutang.forEach(function(acc){ %>
                <div class="hutang-item">
                    <input type="checkbox" id="hutang_<%= acc.nick %>" class="hutang-cb" value="<%= acc.nick %>">
                    <label for="hutang_<%= acc.nick %>"><%= acc.nick %> <small style="color:#6b7280;">(<%= acc.id %>)</small></label>
                </div>
                <% }); %>
            </div>
            <button type="button" class="btn-toggle-all" id="btnToggleHutang">Pilih Semua</button>
        </div>
        <% } %>

        <div class="rs-section">
            <div class="rs-section-title">Web Topup Internal</div>
            <div class="helper-text" id="apiWaitText" style="margin-bottom: 16px;"></div>
            <form action="/process-order-digi" method="POST" id="realstockForm">
                <input type="hidden" name="sku" id="realstockSkuHidden" value="">
                <input type="hidden" name="item_name" id="realstockItemName">
                <input type="hidden" name="modal_price" id="realstockPrice">
                <input type="hidden" name="target_data" id="realstockTargetData">
                <input type="hidden" name="buyer_name" id="realstockBuyerName" value="Stok Internal">
                <div class="form-group">
                    <label>Produk (Digiflazz)</label>
                    <select class="form-control-rs" required id="realstockSku">
                        <option value="">-- Pilih Produk --</option>
                        <% if (products && products.length) { products.forEach(p => { %>
                        <option value="<%= p.buyer_sku_code %>" data-name="<%= (p.product_name || '').replace(/"/g, '&quot;') %>" data-price="<%= p.price || 0 %>"><%= p.product_name %> ‚Äî Rp <%= (p.price || 0).toLocaleString('id-ID') %></option>
                        <% }); } %>
                    </select>
                </div>
                <div class="form-group">
                    <label>Isi Target dari Database (opsional)</label>
                    <select id="realstockAccountPick" class="form-control-rs">
                        <option value="" data-nick="" data-hutang="0">-- Pilih Akun --</option>
                        <% if (typeof accounts !== 'undefined' && accounts.length) { accounts.forEach(acc => { %>
                        <option value="<%= acc.id %>" data-nick="<%= (acc.nick || '').replace(/"/g, '&quot;') %>" data-hutang="<%= acc.pending_wdp ? '1' : '0' %>" data-days="<%= (acc.last_req && acc.last_req.days) ? acc.last_req.days : 0 %>"><%= acc.nick %> (<%= acc.id %>)<% if (acc.pending_wdp) { %> ‚Äî Hutang<% } %></option>
                        <% }); } %>
                    </select>
                    <div id="hutangInfo" class="helper-text" style="margin-top: 8px; padding: 10px; background: #fef3c7; border-radius: 8px; color: #92400e; display: none;"></div>
                </div>
                <div class="form-group">
                    <label>ID Game (User ID)</label>
                    <input type="text" id="realstockTargetId" class="form-control-rs" placeholder="Contoh: 123456782022" required>
                </div>
                <div class="form-group">
                    <label>Server / Zone ID</label>
                    <input type="text" id="realstockTargetZone" class="form-control-rs" placeholder="Contoh: 11420" required>
                </div>
                <button type="submit" class="btn-action btn-blue" style="width: 100%; padding: 16px;">‚ö° Kirim Topup</button>
            </form>
        </div>
    </div>

    <div class="rs-wrap" style="margin-top: 20px;">
    <div class="rs-section-title" style="margin-bottom: 14px;">Daftar Produk</div>
    <div class="grid-container">
        <% if (products && products.length > 0) { %>
            <% products.forEach(p => { %>
                <div class="item-card <%= (p.seller_product_status && p.stock_status === 'available') ? 'ready' : 'gangguan' %>">
                    <div>
                        <div class="sku-badge"><%= p.buyer_sku_code %></div>
                        <div class="item-name"><%= p.product_name %></div>
                    </div>
                    <div>
                        <span class="price-tag">Rp <%= (p.price != null ? p.price : 0).toLocaleString('id-ID') %></span>
                        
                        <% if(p.seller_product_status && p.stock_status === 'available') { %>
                            <button class="btn-action btn-blue" onclick="bukaModal('<%= (p.buyer_sku_code || '').replace(/'/g, "\\'") %>', '<%= (p.product_name || '').replace(/'/g, "\\'") %>', <%= p.price != null ? p.price : 0 %>)">
                                ‚ö° TEMBAK STOK
                            </button>
                        <% } else { %>
                            <button class="btn-action btn-gray" disabled>GANGGUAN</button>
                        <% } %>
                    </div>
                </div>
            <% }) %>
        <% } else { %>
            <div style="grid-column: span 2; text-align: center; color: #888; margin-top: 50px;">
                <p>Gagal memuat produk. <br> Cek koneksi / Config Digiflazz.</p>
            </div>
        <% } %>
    </div>
    </div>

    <script>
        (function() {
            var form = document.getElementById('realstockForm');
            if (!form) return;
            var sel = document.getElementById('realstockSku');
            var skuHidden = document.getElementById('realstockSkuHidden');
            var targetId = document.getElementById('realstockTargetId');
            var targetZone = document.getElementById('realstockTargetZone');
            var targetData = document.getElementById('realstockTargetData');
            var accountPick = document.getElementById('realstockAccountPick');

            function syncHidden() {
                var o = sel && sel.options[sel.selectedIndex];
                if (o && o.value) {
                    if (skuHidden) skuHidden.value = o.value;
                    document.getElementById('realstockItemName').value = o.getAttribute('data-name') || o.textContent || '';
                    document.getElementById('realstockPrice').value = o.getAttribute('data-price') || 0;
                }
            }
            function syncTargetData() {
                var idVal = (targetId.value || '').trim();
                var zoneVal = (targetZone.value || '').trim();
                if (idVal && zoneVal) targetData.value = idVal + ' (' + zoneVal + ')';
                else targetData.value = idVal;
            }
            function parseAccountId(val) {
                var m = (val || '').match(/^(\d+)\((\d+)\)$/);
                return m ? { id: m[1], zone: m[2] } : { id: val, zone: '' };
            }

            if (sel) { sel.addEventListener('change', syncHidden); syncHidden(); }
            if (targetId) targetId.addEventListener('input', syncTargetData);
            if (targetZone) targetZone.addEventListener('input', syncTargetData);
            var buyerNameEl = document.getElementById('realstockBuyerName');
            var hutangInfoEl = document.getElementById('hutangInfo');
            if (accountPick) {
                accountPick.addEventListener('change', function() {
                    var opt = this.options[this.selectedIndex];
                    if (!this.value) {
                        if (targetId) targetId.value = '';
                        if (targetZone) targetZone.value = '';
                        if (buyerNameEl) buyerNameEl.value = 'Stok Internal';
                        if (hutangInfoEl) { hutangInfoEl.style.display = 'none'; hutangInfoEl.textContent = ''; }
                        syncTargetData();
                        return;
                    }
                    var parsed = parseAccountId(this.value);
                    if (targetId) targetId.value = parsed.id || '';
                    if (targetZone) targetZone.value = parsed.zone || '';
                    syncTargetData();
                    var nick = opt && opt.getAttribute('data-nick');
                    if (buyerNameEl) buyerNameEl.value = nick || 'Stok Internal';
                    var hasHutang = opt && opt.getAttribute('data-hutang') === '1';
                    var days = opt && parseInt(opt.getAttribute('data-days'), 10) || 0;
                    if (hutangInfoEl) {
                        if (hasHutang) {
                            hutangInfoEl.innerHTML = 'Akun ini punya hutang WDP. Topup akan <strong>melunasi hutang dulu</strong>, sisa baru masuk stok real.<br><small>Contoh: hutang 2 paket isi 1 = sisa hutang 1; hutang 1 isi 2 = 1 lunas + 1 masuk stok.</small>';
                            hutangInfoEl.style.display = 'block';
                        } else {
                            hutangInfoEl.style.display = 'none';
                            hutangInfoEl.textContent = '';
                        }
                    }
                });
            }

            var waitMs = <%= (typeof cache_info !== 'undefined' && cache_info && cache_info.wait_ms) ? cache_info.wait_ms : 0 %>;
            var waitEl = document.getElementById('apiWaitText');
            if (waitEl && waitMs > 0) {
                function tick() {
                    var m = Math.floor(waitMs / 60000);
                    var s = Math.floor((waitMs % 60000) / 1000);
                    waitEl.textContent = 'Update Digiflazz berikutnya dalam ' + String(m).padStart(2, '0') + ':' + String(s).padStart(2, '0');
                    waitMs = Math.max(0, waitMs - 1000);
                    if (waitMs > 0) setTimeout(tick, 1000);
                }
                tick();
            } else if (waitEl) {
                waitEl.textContent = 'Data Digiflazz siap digunakan.';
            }
        })();
    </script>


    <!-- Modal Konfirmasi Detail (langkah 1 keamanan ganda) -->
    <div id="modalConfirmDetail" class="modal">
        <div class="modal-content">
            <h3 style="margin:0 0 14px;">Konfirmasi Topup</h3>
            <div id="detailSummary"></div>
            <div style="display: flex; gap: 10px; margin-top: 18px;">
                <button type="button" class="btn-action btn-gray" style="flex:1" onclick="tutupModalDetail()">Batal</button>
                <button type="button" class="btn-action btn-blue" style="flex:1" id="btnLanjutDetail">Lanjut</button>
            </div>
        </div>
    </div>
    <!-- Modal Password (langkah 2 keamanan ganda) -->
    <div id="modalPassword" class="modal">
        <div class="modal-content">
            <h3 style="margin:0 0 14px;">Verifikasi</h3>
            <p class="helper-text" style="margin-bottom: 10px;">Masukkan password untuk melanjutkan topup.</p>
            <input type="password" id="inputPassword" class="form-control-rs" placeholder="Password" autocomplete="off" style="margin-bottom: 14px;">
            <div id="passwordError" style="color: #dc2626; font-size: 12px; margin-bottom: 8px; display: none;">Password salah.</div>
            <div style="display: flex; gap: 10px;">
                <button type="button" class="btn-action btn-gray" style="flex:1" onclick="tutupModalPassword()">Batal</button>
                <button type="button" class="btn-action btn-blue" style="flex:1" id="btnSubmitPassword">Kirim</button>
            </div>
        </div>
    </div>

    <div id="modalOrder" class="modal">
        <div class="modal-content" onclick="event.stopPropagation()">
            <h3 style="margin-top:0">üéØ Isi Stok Ke...</h3>
            <p id="namaProduk" style="font-size: 13px; color: #4f46e5; font-weight: bold;"></p>
            
            <form action="/process-order-digi" method="POST" id="modalRealstockForm">
                <input type="hidden" name="sku" id="inputSku">
                <input type="hidden" name="item_name" id="inputName">
                <input type="hidden" name="modal_price" id="inputPrice">
                <input type="hidden" name="target_data" id="inputTargetData">
                <input type="hidden" name="buyer_name" id="inputBuyerName" value="Stok Internal">
                <div class="form-group">
                    <label style="font-size: 12px; font-weight: bold;">Target ID (User ID)</label>
                    <input type="number" id="inputTargetId" class="form-control-rs" placeholder="Contoh: 123456782022" required>
                </div>
                <div class="form-group">
                    <label style="font-size: 12px; font-weight: bold;">Server / Zone ID</label>
                    <input type="number" id="inputTargetZone" class="form-control-rs" placeholder="Contoh: 11420" required>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button type="button" onclick="document.getElementById('modalOrder').style.display='none'" class="btn-action btn-gray">Batal</button>
                    <button type="submit" class="btn-action btn-blue">üî• GAS KIRIM</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        var PASSWORD_TOPUP = '030908';
        var pendingSubmitForm = null;

        function showModalDetail() { document.getElementById('modalConfirmDetail').classList.add('show'); }
        function tutupModalDetail() { document.getElementById('modalConfirmDetail').classList.remove('show'); pendingSubmitForm = null; }
        function showModalPassword() { document.getElementById('modalPassword').classList.add('show'); document.getElementById('inputPassword').value = ''; document.getElementById('passwordError').style.display = 'none'; }
        function tutupModalPassword() { document.getElementById('modalPassword').classList.remove('show'); document.getElementById('inputPassword').value = ''; document.getElementById('passwordError').style.display = 'none'; pendingSubmitForm = null; }

        function buildDetailSummary(form) {
            var fd = new FormData(form);
            var sku = fd.get('sku') || '-';
            var item = fd.get('item_name') || fd.get('item_name') || '-';
            var target = fd.get('target_data') || '-';
            var buyer = fd.get('buyer_name') || '-';
            var price = form.querySelector('input[name="modal_price"]') && form.querySelector('input[name="modal_price"]').value ? form.querySelector('input[name="modal_price"]').value : '-';
            return '<div class="modal-detail-row"><strong>Produk</strong> ' + (item || sku) + '</div>' +
                   '<div class="modal-detail-row"><strong>Target</strong> ' + target + '</div>' +
                   '<div class="modal-detail-row"><strong>Catatan</strong> ' + buyer + '</div>' +
                   '<div class="modal-detail-row"><strong>Harga</strong> Rp ' + (price !== '-' ? Number(price).toLocaleString('id-ID') : '-') + '</div>';
        }

        document.getElementById('btnLanjutDetail').addEventListener('click', function() {
            tutupModalDetail();
            showModalPassword();
        });
        document.getElementById('btnSubmitPassword').addEventListener('click', function() {
            var pwd = document.getElementById('inputPassword').value;
            if (pwd !== PASSWORD_TOPUP) {
                document.getElementById('passwordError').style.display = 'block';
                return;
            }
            tutupModalPassword();
            if (pendingSubmitForm) { pendingSubmitForm.submit(); pendingSubmitForm = null; }
        });

        (function() {
            var form = document.getElementById('realstockForm');
            if (form) {
                form.addEventListener('submit', function(e) {
                    e.preventDefault();
                    document.getElementById('detailSummary').innerHTML = buildDetailSummary(form);
                    pendingSubmitForm = form;
                    showModalDetail();
                });
            }
            var modalForm = document.getElementById('modalRealstockForm');
            if (modalForm) {
                modalForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    document.getElementById('detailSummary').innerHTML = buildDetailSummary(modalForm);
                    pendingSubmitForm = modalForm;
                    document.getElementById('modalOrder').style.display = 'none';
                    showModalDetail();
                });
            }
        })();

        (function() {
            var btn = document.getElementById('btnToggleHutang');
            var cbs = document.querySelectorAll('.hutang-cb');
            if (!btn || !cbs.length) return;
            btn.addEventListener('click', function() {
                var allChecked = Array.prototype.every.call(cbs, function(c) { return c.checked; });
                Array.prototype.forEach.call(cbs, function(c) { c.checked = !allChecked; });
                btn.textContent = allChecked ? 'Pilih Semua' : 'Batal Pilih';
            });
        })();

        function syncModalTarget() {
            var idEl = document.getElementById('inputTargetId');
            var zoneEl = document.getElementById('inputTargetZone');
            var targetEl = document.getElementById('inputTargetData');
            var idVal = (idEl && idEl.value || '').trim();
            var zoneVal = (zoneEl && zoneEl.value || '').trim();
            if (targetEl) targetEl.value = idVal && zoneVal ? (idVal + ' (' + zoneVal + ')') : idVal;
        }
        function bukaModal(sku, nama, harga) {
            document.getElementById('inputSku').value = sku;
            document.getElementById('inputName').value = nama;
            document.getElementById('inputPrice').value = harga;
            document.getElementById('namaProduk').innerText = nama;
            document.getElementById('modalOrder').classList.add('show');
        }
        var inputTargetId = document.getElementById('inputTargetId');
        var inputTargetZone = document.getElementById('inputTargetZone');
        if (inputTargetId) inputTargetId.addEventListener('input', syncModalTarget);
        if (inputTargetZone) inputTargetZone.addEventListener('input', syncModalTarget);
    </script>

    <%- include('./bottom_nav') %>
</body>
</html>
